# MQ基础

## 异步
之前的场景里面有很多步骤都是在一个流程里面需要做完的，就比如说下单系统吧，本来业务简单，下单了付了钱就好了，流程就走完了，但后来流程中增加了很多系统，**如果全部同步调用，那么整个链路时间会很长**。  

链路时间长的原因主要是流程顺序做，但是其实是可以**同时做**的，正常的流程是没有办法实现的，就可以通过MQ来实现**异步**。  

不过异步，也可以通过线程池来做，为什么还要引入MQ呢？

## 解耦
如果通过线程池来做异步，那么就要在代码中直接调用其它业务接口，每次加一个接口都要重新发布系统，系统会很**耦合**。  

除了耦合，另外系统中如果有地方出问题，会有连续的影响。但如果使用了MQ，通过消息的形式来解耦处理，就可以避免这样的问题。  

另外，引入MQ会涉及到**分布式事务**的问题。  

## 削峰
把请求放到队列里面，然后至于每秒消费多少请求，就看自己的服务器处理能力，你能处理5000QPS你就消费这么多，可能会比正常的慢一点，但是不至于打挂服务器，等流量高峰下去了，你的服务也就没压力了。

## 使用消息队列有什么问题
1. 系统复杂性
	本来蛮简单的一个系统，我代码随便写都没事，现在你凭空接入一个中间件在那，我是不是要考虑去维护他，而且使用的过程中是不是要考虑各种问题，比如**消息重复消费、消息丢失、消息的顺序消费**等等，反正用了之后就是贼烦。
2. 数据一致性
	这是分布式服务本身的问题，并不是消息队列特有的问题。   
3. 所有的服务都成功才能算这一次下单是成功的，那怎么才能保证数据一致性呢？   
4. **分布式事务**：把下单，优惠券，积分。。。都放在一个事务里面一样，要成功一起成功，要失败一起失败。
5. 可用性
    你搞个系统本身没啥问题，你现在突然接入一个中间件在那放着，万一挂了怎么办？
    **集群**，**涉及到分布式一致性算法、主从问题等**

